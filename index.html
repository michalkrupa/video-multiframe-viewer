<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi-Video Viewer with Subtitles</title>
  <style>
    * {
      font-family: Arial, Helvetica, sans-serif;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
    }

    #videoWrapper {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    .video-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      opacity: 0;
      overflow: hidden; /* ‚Üê contain scaling */
      transition: opacity 2s ease;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }


    .slider {
      position: absolute;
      top: 0;
      width: 5px;
      height: 100%;
      background: #ccc;
      z-index: 200;
      cursor: ew-resize;
    }

    .slider:hover {
      background: #888;
    }

    .subtitle {
      position: absolute;
      bottom: 0;
      z-index: 150;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      pointer-events: none;
      user-select: none;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    #introOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: opacity 2s ease;
      pointer-events: none;
    }

    .intro-content {
      color: white;
      text-align: center;
      font-size: 1.8em;
      max-width: 80%;
      line-height: 1.6;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="videoWrapper">
    <div class="video-layer" id="video3">
      <video muted autoplay loop playsinline preload="auto"></video>
    </div>
    <div class="video-layer" id="video2" style="clip-path: inset(0 33.33% 0 0); z-index: 10;">
      <video muted autoplay loop playsinline preload="auto"></video>
    </div>
    <div class="video-layer" id="video1" style="clip-path: inset(0 66.66% 0 0); z-index: 20;">
      <video muted autoplay loop playsinline preload="auto"></video>
    </div>

    <!-- Subtitles -->
    <div class="subtitle" id="subtitle1"></div>
    <div class="subtitle" id="subtitle2"></div>
    <div class="subtitle" id="subtitle3"></div>

    <!-- Sliders -->
    <div class="slider" id="slider1" style="left: 33.33%;"></div>
    <div class="slider" id="slider2" style="left: 66.66%;"></div>
  </div>

  <!-- Intro overlay -->
  <div id="introOverlay">
    <div class="intro-content">
      <h1>Visual Experience</h1>
      <p>This content may include intense or graphic imagery. Viewer discretion is advised.</p>
    </div>
  </div>

  <script>
    const videoSets = [
      {
        sources: ["1.mp4", "2.mp4", "3.mp4"],
        startTimes: [10, 30, 100],
        subtitles: [
          "Attribution: Video 1 by Artist A",
          "Attribution: Video 2 by Artist B",
          "Attribution: Video 3 by Artist C"
        ],
        scale: [1.5, 1, 1]
      },
      {
        sources: ["6.mp4", "5.webm", "4.mp4"],
        startTimes: [10, 20, 30],
        subtitles: [
          "Attribution: Video 4 by Artist D",
          "Attribution: Video 5 by Artist E",
          "Attribution: Video 6 by Artist F"
        ],
        scale: [1, 1, 1]
      },
      {
        sources: ["7.mp4", "8.mp4", "9.mp4"],
        startTimes: [0, 15, 45],
        subtitles: [
          "Attribution: Video 7 by Artist G",
          "Attribution: Video 8 by Artist H",
          "Attribution: Video 9 by Artist I"
        ],
        scale: [1, 1, 1]
      }
    ];

    let currentSet = 0;
    let slider1Pct = 33.33;
    let slider2Pct = 66.66;




    function updateSubtitlesFrame() {
      let subtitle1 = document.getElementById("subtitle1");

      let subtitle2 = document.getElementById("subtitle2");

      let subtitle3 = document.getElementById("subtitle3");

      // Subtitle for video 1: from 0 to slider1Pct
      subtitle1.style.left = "0%";
      subtitle1.style.right = `${100 - slider1Pct}%`;

      // Subtitle for video 2: from slider1Pct to slider2Pct
      subtitle2.style.left = `${slider1Pct}%`;
      subtitle2.style.right = `${100 - slider2Pct}%`;

      // Subtitle for video 3: from slider2Pct to 100%
      subtitle3.style.left = `${slider2Pct}%`;
      subtitle3.style.right = "0%";
    }

    function setupBlindSlider(slider, targetId, isSecond = false) {
      const target = document.getElementById(targetId);
      let dragging = false;

      slider.addEventListener("mousedown", () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      });

      window.addEventListener("mouseup", () => {
        dragging = false;
        document.body.style.cursor = "";
      });

      window.addEventListener("mousemove", (e) => {
        if (!dragging) return;

        const rect = document.getElementById("videoWrapper").getBoundingClientRect();
        let offsetX = e.clientX - rect.left;
        offsetX = Math.max(0, Math.min(offsetX, rect.width));
        const pct = (offsetX / rect.width) * 100;

        slider.style.left = pct + "%";

        if (isSecond) {
          slider2Pct = pct;
          target.style.clipPath = `inset(0 ${100 - pct}% 0 0)`;
        } else {
          slider1Pct = pct;
          target.style.clipPath = `inset(0 ${100 - pct}% 0 0)`;
        }

        updateSubtitlesFrame();
      });
    }

    setupBlindSlider(document.getElementById("slider1"), "video1");
    setupBlindSlider(document.getElementById("slider2"), "video2", true);
    updateSubtitlesFrame();

    function loadVideoSet(setIndex) {
      const set = videoSets[setIndex];
      const layers = [
        document.getElementById("video1"),
        document.getElementById("video2"),
        document.getElementById("video3")
      ];
      const videos = layers.map(layer => layer.querySelector("video"));
      const subtitles = [
        document.getElementById("subtitle1"),
        document.getElementById("subtitle2"),
        document.getElementById("subtitle3")
      ];

      currentSet = setIndex;

      videos.forEach((video, i) => {
        video.pause();
        video.src = set.sources[i];
        video.load();

        // Reset video scale on load
        video.style.transform = `scale(${set.scale?.[i] || 1})`;
        video.style.transformOrigin = "center center";

        // Reset subtitle state
        subtitles[i].style.opacity = 0;

        video.addEventListener("loadedmetadata", () => {
          video.currentTime = set.startTimes[i];
          video.play();

          // Delay showing subtitle until video begins
          setTimeout(() => {
            subtitles[i].textContent = set.subtitles[i];
            subtitles[i].style.opacity = 1;

            // setTimeout(() => {
            //   subtitles[i].style.opacity = 0;
            // }, 5000); // Fade out after 5s
          }, 200); // Slight delay to ensure sync with video start
        }, { once: true });
      });
    }

    function swapVideosLoop() {
      setInterval(() => {
        const nextSet = (currentSet + 1) % videoSets.length;
        loadVideoSet(nextSet);
      }, 90000); // 90s loop
    }

    let videosReady = 0;
    document.querySelectorAll("video").forEach(video => {
      video.addEventListener("loadeddata", () => {
        videosReady++;
        if (videosReady >= 3) {
          setTimeout(() => {
            document.getElementById("introOverlay").style.opacity = 0;

            document.querySelectorAll(".video-layer").forEach(layer => {
              layer.style.opacity = 1;
            });

            setTimeout(() => {
              document.getElementById("introOverlay").remove();
            }, 2000);

            loadVideoSet(0);
            swapVideosLoop();
          }, 3000);
        }
      });
    });

    loadVideoSet(0); // preload first set
  </script>
</body>
</html>
